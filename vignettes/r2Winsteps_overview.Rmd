---
title: "r2Winsteps: An R package for interfacing between R and the Rasch Modeling Software Winsteps"
author: "Daniel Anderson"
date: "`r Sys.Date()`"
bibliography: r2Winsteps.bib
output: pdf_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The `r2Winsteps` package was developed to provide a convenient interface
  between *R* and the Rasch modeling software *Winsteps*. The package is not intended to encompass the full capabilities of *Winsteps*, but rather to provide a simple framework for estimating many commonly applied models. The primary features of the package include:

* Write control and data files for Winsteps with the `r2Winsteps()` function,
  which includes automatic detection of partial credit scoring. For partial credit scoring, either the rating scale [default; @Andrich] or partial credit models [@Masters] can be estimated.
* Run Winsteps directly from R with the `runWinsteps()` function, which writes
  and executes a `.bat` file to call *Winsteps*. Both item and person parameters are returned in a list, and intermediary files (control and data) can be stored or discarded (default).
* Batch run a set of models with the `batchRunWinsteps()` files. Essentially
  does the same thing as `runWinsteps()`, but takes as its argument a list of data frames, with a different model fit and parameter estimates returned for each data frame in the list.

Note that the package is still in development, and plotting features are next
  on the docket for inclusion. For now, any plotting you'd like to do will either need to be completed manually after running the models, or through Winsteps directly. The purpose of this vignette is to provide a few illustrated examples of using the package.

# Installation
For the time being, the *r2Winsteps* package is housed exclusively on 
  *github*. Installation is straightforward via the *devtools* package. If you don't have *devtools* installed, you will need to first run the following:

```{r, devtoolsInstall, eval = FALSE}
install.packages("devtools")
```

Then, you just need to load the *devtools* package and install *r2Winsteps* directly from github.

```{r, install, eval = FALSE}
library(devtools)
install_github("DJAnderson07/r2Winsteps")
```

Winsteps is exclusively designed for Windows, and if you are on a Windows machine you should be good to go from here. However, if you'd like to use a Mac, you can do so through *Wine* (see https://www.winehq.org), a free, open-source "compatibility layer" for running windows programs on OS X. There are several approaches you can take here. Below, I walk you through what I have found the most successful. First, download and install Wine Bottler, which is also free: http://winebottler.kronenberg.org (be careful not to accidentally download any of the other pop-up software). You'll then need to double click the .dmg file, which will prompt you to drag two apps into  your application folder, as shown below. 


At this point, you can try to use Wine Bottler to install *Winsteps* (click on *Advanced*, then *Select File*, navigate to the Winsteps installer (.exe), then click *Open*, then *Install*. Save as *Winsteps*). If this works, you're in great shape. Regardless, you will want the Wine app that comes with Wine Bottler.

If you get hit with one or more errors when installing with Wine Bottler, I suggest instead installing wine directly with homebrew, as outlined here: http://www.davidbaumgold.com/tutorials/wine-mac/. When you run `brew install wine`, make sure you do not get any errors. If you do, run `brew doctor` and cut and paste the code it suggests. At this point, you should have wine installed. The last step is to install Winsteps. To do this, first locate the executable installer file (.exe). Then type `wine`, followed by a space, and then drag the executable into terminal. This should copy the path to the executable. For example, it may looks something like the below

```
wine /Applications/v3.91/WinstepsPasswordInstall3910.exe
```
You will then be taken through the Winsteps installation process, just as you would if you were on a Windows machine (note, you will need your password here). If you're still having issues, look closely again at `brew doctor`. If you can't find the answer there, google is your friend.

After installing wine, open a text editor and save the empty file as *temp.bat*. Select the file, and hit command + i. This should open the dialoge box below. 

OPEN ALL .BAT FILES WITH WINE


**One last Note:** Older versions of Winsteps included different (less) output from the item and person files. The *r2Winsteps* package was built with *Winsteps* Version 3.90. If you have an earlier version of Winsteps, there are workarounds you can use in the options of the `read.pfile()` and `read.ifile()` functions, and you may want to consider modifying the source code for your particular installation.

# Using the package: Example 1, LSAT data
Now that everything is installed, let's start with a simple example. We'll begin by fitting a Rasch model with dichotomous, using the supplied LSAT data.

```{r, loadData}
library(r2Winsteps)
data(LSAT)
head(LSAT)
```
It's generally a good idea to inspect some preliminary data, so we can get an idea of what to expect from the model, and whether the assumptions of the model appear tenable. First, we'll estimate the proportion of respondents responding correctly to the items. Because the items are dichotomous, this is just the mean.

```{r, pValues}
apply(LSAT[ ,4:8], 2, mean)
```
So all items appear somewhat easy, but Item 1 is clearly the easiest while Item 3 is clearly the most difficult. 

Next, we can compute the point-biserial correlation, by correlating the response vector for each item with a vector of raw scores. We'll compute the raw scores, and then compute the correlations.

```{r, ptBiserial}
raw <- rowSums(LSAT[ ,4:8])
round( sapply(LSAT[ ,4:8], function(i) cor(i, raw)), 2)
```
These are classical test theory indicators of *item discrimination*. The Rasch model assumes essentially equivalent item discrimination, and so we're looking to see if any items appear wildly different from the others. It's also worth noting that item-fit statistics reported by *Winsteps*, such as the mean square outfit, are produced by evaluating the differences from the *average* biserial correlation [see @Wu]. These all appear reasonable, so let's go ahead and fit the model. In this case, because the model and data are straightforward, we simply need to call the `runWinsteps()` function, which requires the data be split into a data frame of item responses and a data frame of person demographics.

```{r, LSAT_mod1}
pars_LSAT <- runWinsteps(LSAT[ ,4:8], LSAT[ ,1:3])
str(pars_LSAT)
```

The function writes a *.bat* file and executes it to call Winsteps. Other functions in the package are then called to read the item and person parameters back into R. 

\newpage

# References